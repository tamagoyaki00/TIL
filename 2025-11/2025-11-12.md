## 2025-11-12学習記録

さっそく、同期がフィードバックくれたので、バグについて修正
設定→プロフィール→戻るボタンをクリックするとモーダルが表示され続けていて、画面操作ができなくなるというものでした。

調べてみると、原因は、TurboがページのDOMをキャッシュして復元していること。
通常のものは、ページを再生成する為、このようなことにはならないみたいです。
モーダルの開け閉めのStimulusに以下を追加
```
  connect() {
    document.addEventListener("turbo:before-visit", this.closeIfOpen)
  }

    closeIfOpen = () => {
    if (this.hasModalTarget && this.modalTarget.open) {
      this.close()
    }
  }
```
`turbo:before-visit`ページ訪問前に発火するイベント。（＝リンクを押してページ遷移する前にcloseIfOpenを実施）
`closeIfOpen` モーダルが開いていたら閉じるように

