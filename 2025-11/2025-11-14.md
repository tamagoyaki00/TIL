## 2025-11-14学習記録

WEBのレイアウトを修正！
WEBではサイドバーやヘッダーにメニューがある印象が強くその操作に慣れているという指摘を受けており
自分自身も右上の設定ボタンと中身が合っていないという印象を抱いていたので、思い切ってサイドバーに修正してみました。


### 以前のデスクトップでの画面
![スクリーンショット 2025-10-19 193353](https://github.com/user-attachments/assets/90c47636-11e2-43bc-b6b3-22bd2db5dcf4)

### 変更後のデスクトップでの画面
![スクリーンショット 2025-11-15 114052](https://github.com/user-attachments/assets/ea04b8c8-99e3-475c-b85f-8e4fca9b0388)

みやすくなりました～！


### capybaraで画面の大きさを指定してテストを実行する方法
サイドバーを設置したことにより、マイ日記・みんなの日記のFABボタンをlg以上の画面では廃止したため、画面の大きさを指定し、テストを実行する必要がありました。  
例スマホ画面: `page.driver.browser.manage.window.resize_to(375, 812)`
を追加するだけで、この画面の大きさでテストが実行されます！

### テストの共通化`shared_examples`
今回、マイ日記・みんなの日記で画面の大きさに応じて、FABボタンの存在の有無、存在した場合は日記作成ページに遷移できるかどうかというテストを実装したい。
簡単にいうと、異なるページで、同じテストを実行したい。

2回くらいなら、同じ内容のテストを2回書いてもいいのですが、shared_examplesという共通化できるものがあると知ったので使ってみました。

```
shared_examples 'FABボタンから日記作成画面へ遷移できること' do |path|
    it 'スマホ画面ではFABボタンから日記作成画面に遷移できる' do
        page.driver.browser.manage.window.resize_to(375, 812)
        visit public_send(path)
        find('a.btn.btn-primary.btn-circle').click
        expect(page).to have_current_path new_diary_path
        expect(page).to have_content '今日の一日を振り返ってみよう'
    end

    it 'タブレット画面でもFABボタンから日記作成画面に遷移できる' do
        page.driver.browser.manage.window.resize_to(768, 1024)
        visit public_send(path)
        find('a.btn.btn-primary.btn-circle').click
        expect(page).to have_current_path new_diary_path
    end

    it 'デスクトップ画面ではFABボタンが表示されない' do
        page.driver.browser.manage.window.resize_to(1024, 768)
        visit public_send(path)
        expect(page).to have_no_css('a.btn.btn-primary.btn-circle')
    end
end

context 'マイ日記ページ' do
    include_examples 'FABボタンから日記作成画面へ遷移できること', :my_diaries_path
end

context 'みんなの日記ページ' do
    include_examples 'FABボタンから日記作成画面へ遷移できること', :public_diaries_path
end
```
shared_examplesでスマホ画面・タブレット・デスクトップでFABボタンの有無とFABボタンがあった場合は日記作成画面へ遷移できるかどうかという共通テストを書いています。引数に`path`を受け取り、`visit public_send(path)`で利用しています。


そして、共通化したテストを使いたいところで　**`include_examples`共通化テストの名前,　引数**　を書くだけ！
これで何回も同じテストを書く手間が省けました。

今回は、同じファイル内で共通化して利用しましたが、
ファイルを跨いで共通化したい場合は、`spec/support/shared_examples/presence_examples.rb`ファイルなどを作る
例：
```
RSpec.shared_examples "presence validation" do |attribute|
  it "is invalid without #{attribute}" do
    record = described_class.new(attribute => nil)
    expect(record).to be_invalid
    expect(record.errors[attribute]).to include("can't be blank")
  end
end
```

利用側
```
RSpec.describe User, type: :model do
  it_behaves_like "presence validation", :name
  it_behaves_like "presence validation", :email
end

RSpec.describe Post, type: :model do
  it_behaves_like "presence validation", :title
end
```
