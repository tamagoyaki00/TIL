## 2025-09-20学習記録
学習時間6.8時間（総合学習時間944）

TO DO
- [x] wheneverの導入
- [x] cronの設定
- [x] external idの設定
- [ ] OnesignalAPIの設定途中


## 学び
OneSignalは、ユーザーがサイトを訪れた時点で、そのユーザーをexternal_idで識別することを推奨しているため、UUIDをデフォルトで発行しないようにしていましたが、発行するように変更。
その際にUserモデルにコールバック`before_validation :set_onesignal_external_id, on: :create`を追加
これはバリデーションを行う前に`set_onesignal_external_id`メソッドを実行するものです。

### コールバックとは
オブジェクトが生成(create)、更新(update)、破壊(delete)される時や、バリデーションを実行する時の前後に共通の処理を追加する仕組みをいう。これはモデル層で指定でき、処理を共通化することによって、モデルの一貫性を保て、またコード量を減らすことができるメリットがある。

これを設定することで、ユーザーが新規登録すると同時に`nesignal_external_id`カラムを追加することができる。
その他にも今回通知の設定の初期値を設定`after_create :create_default_notification_setting`
今までは、ユーザーが入力したものをデータベースに保存→編集のように実行していたが、今回の通知設定はユーザーが入力したものをDBに保存という`new` `create`アクションの該当するものがない。そのため`update`アクションを実行しようとしたときに元のデータがないから変更ができないよ！というエラーがでた。なのでユーザーの新規登録の後に、通知設定の初期値を設定する記述をすることでエラーを解消できました！  
考えてみたら元のデータがないと変更できないのは当たり前なのですが、今までそういった内容に直面したことがなく、いい学びになりました。

