## 2025-08-18学習記録
学習時間4.8時間（総合学習時間807）

TO DO
- [x]  ユーザーのプロフィール画像をお題作成者のアイコンにも反映するように
- [x]  ユーザーのプロフィール画像を意見投稿時のアイコンにも反映するように
- [x]  ソート機能
- [ ]  docker完全ガイド

## 学び

### ソート機能(以下の項目で並べ替え)
- 新着順
- 古い順
- 投票数が多い順
- 意見が多い順

**scopeメソッド**

モデルにおける`scope`とはActiveRecordの機能の一つです｡

モデル側で共通の条件式(クエリ処理)に名前を付けて定義し､その名前でメソッドのように呼び出すことができる仕組みのことです｡

※カリキュラムでもやった

app/models/question.rbにscopeを追加

```ruby

  scope :most_voted, -> {
    left_joins(:votes).group('questions.id').order('COUNT(votes.id) DESC')
  }

  scope :most_opinions, -> {
    left_joins(:opinions).group('questions.id').order('COUNT(opinions.id) DESC')
  }

  scope :oldest, -> { order(created_at: :asc) }
```

※`left_joins`を使わないと投票数がないものは表示されない


app/controllers/questions_controller.rb

上記で作成したスコープを使う

```ruby
  def index
    @questions = case params[:sort_by]
                 when 'most_voted'
                   Question.most_voted
                 when 'most_opinions'
                   Question.most_opinions
                 when 'oldest'
                   Question.oldest
                 else
                   Question.order(created_at: :desc)
                 end
  end
```

app/views/questions/index.html.erb

```ruby
    <%= form_with url: questions_path, method: :get, local: true do %>
      <%= select_tag :sort_by, options_for_select([
        ['新着順', 'latest'], 
        ['古い順', 'oldest'], 
        ['投票数が多い順', 'most_voted'], 
        ['意見数が多い順', 'most_opinions']
      ], params[:sort_by]), onchange: 'this.form.submit();' %>
    <% end %>
```

`select_tag :sort_by` でプルダウン形式で選んだものはコントローラーで `params[:sort_by]` として受け取る。

`options_for_select` でプルダウンの選択肢を生成

`onchange: 'this.form.submit();'` 更新ボタンを押さなくても、並べ替えができます。（インラインjavascript）

### その他
卒制をそろそろやらなきゃなぁという気持ちに・・・
現在作成しているアプリもひと段落はついてきたので、卒制のREADME取り組んだり、
figmaの使い方学んだりしますか。
